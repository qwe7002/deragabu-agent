syntax = "proto3";

package cursor;

// Main cursor message
message CursorMessage {
    MessageType type = 1;

    oneof payload {
        CursorData cursor_data = 2;          // Cursor image data (sent once per cursor, cached by client)
        CursorSignal cursor_signal = 3;      // Cursor switch signal (sent on change)
        ClipboardData clipboard_data = 5;    // Clipboard sync payload (bidirectional)
        SettingsData settings_data = 6;      // Server settings (draw_cursor state, etc.)
    }

    uint64 timestamp = 4;
}

// Cursor image data - WebP encoded, sent once per unique cursor
message CursorData {
    string cursor_id = 1;           // Unique ID (hash of cursor image)
    bytes image_data = 2;           // WebP encoded cursor image
    int32 width = 3;                // Original image width in pixels
    int32 height = 4;               // Original image height in pixels
    int32 hotspot_x = 5;            // Hotspot X in pixels (relative to image)
    int32 hotspot_y = 6;            // Hotspot Y in pixels (relative to image)
    float dpi_scale = 7;            // Server-side DPI scale factor (e.g. 1.0, 1.25, 1.5, 2.0)
    bool is_animated = 8;           // True if this is a frame of an animated cursor
    uint32 frame_delay_ms = 9;      // Estimated delay between animation frames (ms)
}

// Cursor switch signal - lightweight, tells client which cached cursor to show
message CursorSignal {
    string cursor_id = 1;           // Reference to cached cursor image
}

// Clipboard sync data - sent server→client on host clipboard change,
// or client→server to push browser clipboard to host.
message ClipboardData {
    ClipboardContentType content_type = 1;  // Type of clipboard content
    bytes payload = 2;                      // UTF-8 text bytes, or raw PNG bytes for images
    string content_hash = 3;               // blake3 hex hash for deduplication
    repeated string filenames = 4;         // File names (stub: for FILES type, payload is empty)
    repeated uint64 file_sizes = 5;        // Corresponding file sizes in bytes (stub)
}

// Type of clipboard content
enum ClipboardContentType {
    CLIPBOARD_CONTENT_TYPE_UNSPECIFIED = 0;
    CLIPBOARD_CONTENT_TYPE_TEXT = 1;    // payload = UTF-8 text
    CLIPBOARD_CONTENT_TYPE_IMAGE = 2;   // payload = raw PNG bytes (uncompressed, original format)
    CLIPBOARD_CONTENT_TYPE_FILES = 3;   // payload empty; filenames/file_sizes populated (stub)
}

enum MessageType {
    MESSAGE_TYPE_UNSPECIFIED = 0;
    MESSAGE_TYPE_CURSOR_DATA = 1;    // New cursor image (client should cache)
    MESSAGE_TYPE_CURSOR_SIGNAL = 2;  // Switch to cached cursor
    MESSAGE_TYPE_CURSOR_HIDE = 3;    // Cursor hidden
    MESSAGE_TYPE_HEARTBEAT = 4;      // Heartbeat
    MESSAGE_TYPE_CLIPBOARD = 5;      // Clipboard sync (bidirectional)
    MESSAGE_TYPE_SETTINGS = 6;       // Server settings (draw_cursor state, etc.)
}

// Server-side settings pushed to clients
message SettingsData {
    bool draw_cursor = 1;              // Whether Sunshine draws cursor in the video stream
}

